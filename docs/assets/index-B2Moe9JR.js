(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();/**
 * Polymatic v0.0.12
 * @copyright Copyright 2026 Ali Shakiba
 * @license Licensed under the MIT (https://github.com/piqnt/polymatic/blob/main/LICENSE.md)
 */function zt(i){try{const t=localStorage.getItem(i);if(t)return t}catch{}try{const t=sessionStorage.getItem(i);if(t)return t}catch{}}function pt(i,t){let e=zt(i+"_exclude"),n=zt(i+"_include");try{if(e&&t.match(e))return!1}catch(s){console.log(s)}try{if(n&&t.match(n))return!0}catch(s){console.log(s)}return!1}function ie(i,t){const e=pt("debug",i),n=pt("trace",i);return e?(...s)=>{t&&!t(...s)||(console.log(i,...s),n&&console.trace())}:()=>{}}function pe(i,t){const e=pt("watch",i),n=pt("trace",i);return e?new Proxy(t,{set(s,r,o,h){return console.debug(i,".",r.toString(),s[r],"↬",o),n&&console.trace(),Reflect.set(s,r,o,h)}}):t}const Nt=ie("middleware.event",i=>!(i!=null&&i.endsWith("-move")||i==="hotsyncWorld")),qt=ie("middleware.lifecycle");class x{constructor(){this.__handlers={},this.__children=[],this.__parent=null,this._swap=t=>{const e=this.__children,n=[],s=[];for(const r of t)e.indexOf(r)===-1&&s.push(r);for(const r of e)t.indexOf(r)===-1&&n.push(r);this.__children=t;for(const r of n)r.__detach();for(const r of s)r.__attach(this)}}get activated(){return this.__parent&&this.__parent.activated}use(t){this.__children.indexOf(t)===-1&&(this.activated&&t.__attach(this),this.__children.push(t))}unuse(t){const e=this.__children.indexOf(t);e!==-1&&(this.__children.splice(e,1),t==null||t.__detach())}__attach(t){if(!this.__parent){this.__parent=t,qt("activate","+",this.constructor.name),this._handle("activate");for(let e=0;e<this.__children.length;e++)this.__children[e].__attach(this)}}__detach(){if(this.__parent){qt("deactivate","-",this.constructor.name),this._handle("deactivate");for(let t=0;t<this.__children.length;t++)this.__children[t].__detach();this.__parent=null}}get context(){return this.__parent?this.__parent.context:null}setContext(t){this.__parent?this.__parent.setContext(t):console.error("Middleware is not activated")}on(t,e){if(this.__handlers[t])throw Error(`Handler for ${t} already exists`);this.__handlers[t]=e}_consume(t,e){if(this._handle(t,e))return!0;for(let s=0;s<this.__children.length;s++)if(this.__children[s]._consume(t,e))return!0;return!1}_handle(t,e){if(!this.activated)return;const n=this.__handlers&&this.__handlers[t];return!!(n&&typeof n=="function"&&(Nt(t,"→",this.constructor.name,e),n.call(this,e)===!0))}emit(t,e){this.activated&&(Nt(t,"↑",this.constructor.name,e),this.__parent?this.__parent.emit(t,e):console.error(Error("Not active!")))}static activate(t,e){return jt.activate(t,e)}}class jt extends x{constructor(){super(...arguments),this.__handlers={},this.__children=[],this._activated=!1,this.contextUpdateEmit=()=>{this.emit("context-change")}}get activated(){return this._activated}_activate(t){if(!this._activated){t=pe("middleware.context",t),this._context=t,this._activated=!0,this._handle("activate");for(let e=0;e<this.__children.length;e++)this.__children[e].__attach(this)}}_deactivate(){if(this._activated){this._activated=!1,this._handle("deactivate");for(let t=0;t<this.__children.length;t++)this.__children[t].__detach()}}get context(){return this._context}setContext(t){if(typeof t!="function"){console.error("Setter is not a function: ",t);return}t(this.context),clearTimeout(this.contextUpdateEmitTimeout),this.contextUpdateEmitTimeout=setTimeout(this.contextUpdateEmit)}emit(t,e){setTimeout(()=>{this._consume(t,e)})}static activate(t,e){const n=new jt;n.use(t),n._activate(e)}static deactivate(t){if("_deactivate"in t&&typeof t._deactivate=="function")return t._deactivate(),!0;const e=t.__parent;return e&&"_deactivate"in e&&typeof e._deactivate=="function"?(e._deactivate(),!0):!1}}class _t{constructor(){this._componentsById={}}static create(t){return new class extends _t{constructor(){super(...arguments),this.filter=t.filter,this.enter=t.enter,this.exit=t.exit,this.update=t.update}}}ref(t){return this._componentsById[t]}}class Lt{constructor(){this._drivers=[],this._map={},this._mapBuffer={},this._updateBuffer=[],this._enterBuffer=[],this._exitBuffer=[]}static create(t){return new class extends Lt{constructor(){super(...arguments),this.key=t.key,this._drivers=t.drivers?[...t.drivers]:[]}}}addDriver(t){if(!(t&&t.filter&&t.enter&&t.exit&&t.update))throw"Invalid driver: "+t;return this._drivers.push(t),this}data(t){if(!Array.isArray(t))throw"Invalid data: "+t;this._enterBuffer.length=0,this._exitBuffer.length=0,this._updateBuffer.length=t.length;for(let n=0;n<t.length;n++){const s=t[n];if(typeof s!="object"||s===null)continue;const r=this.key(s);this._map[r]?delete this._map[r]:this._enterBuffer.push(s),this._updateBuffer[n]=s,this._mapBuffer[r]=s}for(const n in this._map)this._exitBuffer.push(this._map[n]),delete this._map[n];const e=this._map;this._map=this._mapBuffer,this._mapBuffer=e;for(let n=0;n<this._exitBuffer.length;n++){const s=this._exitBuffer[n],r=this.key(s);for(const o of this._drivers){if(o.filter(s)){const h=o._componentsById[r];o.exit(s,h)}delete o._componentsById[r]}}for(let n=0;n<this._enterBuffer.length;n++){const s=this._enterBuffer[n],r=this.key(s);for(const o of this._drivers)if(o.filter(s)){const h=o.enter(s);h&&(o._componentsById[r]=h)}}for(let n=0;n<this._updateBuffer.length;n++){if(typeof t[n]!="object"||t[n]===null)continue;const s=this._updateBuffer[n],r=this.key(s);for(const o of this._drivers)if(o.filter(s)){const h=o._componentsById[r];o.update(s,h)}}this._enterBuffer.length=0,this._exitBuffer.length=0,this._updateBuffer.length=0}}class N{constructor(){this.memory=[]}static init(...t){const e=new N;return t.length&&e.update(...t),e}update(...t){let e=this.memory.length===t.length;for(let n=0;n<t.length;n++)e=e&&this.memory[n]===t[n],this.memory[n]=t[n];return this.memory.length=t.length,!e}clear(){this.memory.length=0}}/**
 * Stage.js v1.0.0-alpha.23
 * @copyright Copyright Ali Shakiba
 * @license Licensed under the MIT (https://github.com/piqnt/stage.js/blob/main/LICENSE.md)
 */var _e=Math.random,ve=Math.sqrt;function me(i,t){return typeof i>"u"?(t=1,i=0):typeof t>"u"&&(t=i,i=0),i==t?i:_e()*(t-i)+i}function ne(i,t,e){return typeof t>"u"?(e=1,t=0):typeof e>"u"&&(e=t,t=0),e>t?(i=(i-t)%(e-t),i+(i<0?e:t)):(i=(i-e)%(t-e),i+(i<=0?t:e))}function se(i,t,e){return i<t?t:i>e?e:i}function ge(i,t){return ve(i*i+t*t)}var U=Object.create(Math);U.random=me;U.wrap=ne;U.clamp=se;U.length=ge;U.rotate=ne;U.limit=se;var Vt=function(){function i(t,e,n,s,r,o){this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,typeof t=="object"?this.reset(t):this.reset(t,e,n,s,r,o)}return i.prototype.toString=function(){return"["+this.a+", "+this.b+", "+this.c+", "+this.d+", "+this.e+", "+this.f+"]"},i.prototype.clone=function(){return new i(this.a,this.b,this.c,this.d,this.e,this.f)},i.prototype.reset=function(t,e,n,s,r,o){return this._dirty=!0,typeof t=="object"?(this.a=t.a,this.d=t.d,this.b=t.b,this.c=t.c,this.e=t.e,this.f=t.f):(this.a=typeof t=="number"?t:1,this.b=typeof e=="number"?e:0,this.c=typeof n=="number"?n:0,this.d=typeof s=="number"?s:1,this.e=typeof r=="number"?r:0,this.f=typeof o=="number"?o:0),this},i.prototype.identity=function(){return this._dirty=!0,this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this},i.prototype.rotate=function(t){if(!t)return this;this._dirty=!0;var e=t?Math.cos(t):1,n=t?Math.sin(t):0,s=e*this.a-n*this.b,r=e*this.b+n*this.a,o=e*this.c-n*this.d,h=e*this.d+n*this.c,c=e*this.e-n*this.f,a=e*this.f+n*this.e;return this.a=s,this.b=r,this.c=o,this.d=h,this.e=c,this.f=a,this},i.prototype.translate=function(t,e){return!t&&!e?this:(this._dirty=!0,this.e+=t,this.f+=e,this)},i.prototype.scale=function(t,e){return!(t-1)&&!(e-1)?this:(this._dirty=!0,this.a*=t,this.b*=e,this.c*=t,this.d*=e,this.e*=t,this.f*=e,this)},i.prototype.skew=function(t,e){if(!t&&!e)return this;this._dirty=!0;var n=this.a+this.b*t,s=this.b+this.a*e,r=this.c+this.d*t,o=this.d+this.c*e,h=this.e+this.f*t,c=this.f+this.e*e;return this.a=n,this.b=s,this.c=r,this.d=o,this.e=h,this.f=c,this},i.prototype.concat=function(t){this._dirty=!0;var e=this.a*t.a+this.b*t.c,n=this.b*t.d+this.a*t.b,s=this.c*t.a+this.d*t.c,r=this.d*t.d+this.c*t.b,o=this.e*t.a+t.e+this.f*t.c,h=this.f*t.d+t.f+this.e*t.b;return this.a=e,this.b=n,this.c=s,this.d=r,this.e=o,this.f=h,this},i.prototype.inverse=function(){if(this._dirty){this._dirty=!1,this.inverted||(this.inverted=new i);var t=this.a*this.d-this.b*this.c;this.inverted.a=this.d/t,this.inverted.b=-this.b/t,this.inverted.c=-this.c/t,this.inverted.d=this.a/t,this.inverted.e=(this.c*this.f-this.e*this.d)/t,this.inverted.f=(this.e*this.b-this.a*this.f)/t}return this.inverted},i.prototype.map=function(t,e){return e=e||{x:0,y:0},e.x=this.a*t.x+this.c*t.y+this.e,e.y=this.b*t.x+this.d*t.y+this.f,e},i.prototype.mapX=function(t,e){return typeof t=="object"&&(e=t.y,t=t.x),this.a*t+this.c*e+this.e},i.prototype.mapY=function(t,e){return typeof t=="object"&&(e=t.y,t=t.x),this.b*t+this.d*e+this.f},i}();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Mt=function(i,t){return Mt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var s in n)n.hasOwnProperty(s)&&(e[s]=n[s])},Mt(i,t)};function j(i,t){Mt(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var At=function(){return At=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},At.apply(this,arguments)};function re(i,t,e,n){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function h(f){try{a(n.next(f))}catch(u){o(u)}}function c(f){try{a(n.throw(f))}catch(u){o(u)}}function a(f){f.done?r(f.value):s(f.value).then(h,c)}a((n=n.apply(i,[])).next())})}function oe(i,t){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},n,s,r,o;return o={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function h(a){return function(f){return c([a,f])}}function c(a){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,s&&(r=a[0]&2?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[a[0]&2,r.value]),a[0]){case 0:case 1:r=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,s=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(r=e.trys,!(r=r.length>0&&r[r.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!r||a[1]>r[0]&&a[1]<r[3])){e.label=a[1];break}if(a[0]===6&&e.label<r[1]){e.label=r[1],r=a;break}if(r&&e.label<r[2]){e.label=r[2],e.ops.push(a);break}r[2]&&e.ops.pop(),e.trys.pop();continue}a=t.call(i,e)}catch(f){a=[6,f],s=0}finally{n=r=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}var he=Object.prototype.toString;function Et(i){var t=he.call(i);return t==="[object Function]"||t==="[object GeneratorFunction]"||t==="[object AsyncFunction]"}function vt(i){return he.call(i)==="[object Object]"&&i.constructor===Object}const W={create:0,tick:0,component:0,draw:0,fps:0};var wt=function(){return Date.now().toString(36)+Math.random().toString(36).slice(2)},ot=function(){function i(){this.uid="texture:"+wt(),this.sx=0,this.sy=0,this.dx=0,this.dy=0}return i.prototype.setSourceCoordinate=function(t,e){this.sx=t,this.sy=e},i.prototype.setSourceDimension=function(t,e){this.sw=t,this.sh=e},i.prototype.setDestinationCoordinate=function(t,e){this.dx=t,this.dy=e},i.prototype.setDestinationDimension=function(t,e){this.dw=t,this.dh=e},i.prototype.draw=function(t,e,n,s,r,o,h,c,a){var f,u,v,m,d,_,l,g;arguments.length>5?(f=this.sx+e,u=this.sy+n,v=s??this.sw,m=r??this.sh,d=this.dx+o,_=this.dy+h,l=c??this.dw,g=a??this.dh):arguments.length>1?(f=this.sx,u=this.sy,v=this.sw,m=this.sh,d=this.dx+e,_=this.dy+n,l=s??this.dw,g=r??this.dh):(f=this.sx,u=this.sy,v=this.sw,m=this.sh,d=this.dx,_=this.dy,l=this.dw,g=this.dh),this.drawWithNormalizedArgs(t,f,u,v,m,d,_,l,g)},i}(),ae=function(i){j(t,i);function t(e,n){var s=i.call(this)||this;return s._pixelRatio=1,s.padding=0,typeof e=="object"&&s.setSourceImage(e,n),s}return t.prototype.setSourceImage=function(e,n){n===void 0&&(n=1),this._source=e,this._pixelRatio=n},t.prototype.setPadding=function(e){this.padding=e},t.prototype.getWidth=function(){return this._source.width/this._pixelRatio+(this.padding+this.padding)},t.prototype.getHeight=function(){return this._source.height/this._pixelRatio+(this.padding+this.padding)},t.prototype.prerender=function(e){return!1},t.prototype.drawWithNormalizedArgs=function(e,n,s,r,o,h,c,a,f){var u=this._source;if(!(u===null||typeof u!="object")){r=r??this._source.width/this._pixelRatio,o=o??this._source.height/this._pixelRatio,a=a??r,f=f??o,h+=this.padding,c+=this.padding;var v=n*this._pixelRatio,m=s*this._pixelRatio,d=r*this._pixelRatio,_=o*this._pixelRatio;try{W.draw++,e.drawImage(u,v,m,d,_,h,c,a,f)}catch(l){this._draw_failed||(console.log("Unable to draw: ",u),console.log(l),this._draw_failed=!0)}}},t}(ot),Xt=function(i){j(t,i);function t(e){var n=i.call(this)||this;return n._source=e,n}return t.prototype.setSourceTexture=function(e){this._source=e},t.prototype.getWidth=function(){var e,n;return(n=(e=this.dw)!==null&&e!==void 0?e:this.sw)!==null&&n!==void 0?n:this._source.getWidth()},t.prototype.getHeight=function(){var e,n;return(n=(e=this.dh)!==null&&e!==void 0?e:this.sh)!==null&&n!==void 0?n:this._source.getHeight()},t.prototype.prerender=function(e){return this._source.prerender(e)},t.prototype.drawWithNormalizedArgs=function(e,n,s,r,o,h,c,a,f){var u=this._source;u===null||typeof u!="object"||u.draw(e,n,s,r,o,h,c,a,f)},t}(ot),Jt=function(i){j(t,i);function t(e){e===void 0&&(e={});var n=i.call(this)||this;return n.pipeSpriteTexture=function(s){var r=n._map,o=n._ppu,h=n._trim;if(s){s=Object.assign({},s),Et(r)&&(s=r(s)),o!=1&&(s.x*=o,s.y*=o,s.width*=o,s.height*=o,s.top*=o,s.bottom*=o,s.left*=o,s.right*=o),h!=0&&(s.x+=h,s.y+=h,s.width-=2*h,s.height-=2*h,s.top-=h,s.bottom-=h,s.left-=h,s.right-=h);var c=new Xt(n);return c.top=s.top,c.bottom=s.bottom,c.left=s.left,c.right=s.right,c.setSourceCoordinate(s.x,s.y),c.setSourceDimension(s.width,s.height),c}},n.findSpriteDefinition=function(s){var r=n._textures;if(r){if(Et(r))return r(s);if(vt(r))return r[s]}},n.select=function(s){if(!s)return new mt(new Xt(n));var r=n.findSpriteDefinition(s);if(r)return new mt(r,n)},n.name=e.name,n._ppu=e.ppu||e.ratio||1,n._trim=e.trim||0,n._map=e.map||e.filter,n._textures=e.textures,typeof e.image=="object"&&vt(e.image)?("src"in e.image?n._imageSrc=e.image.src:"url"in e.image&&(n._imageSrc=e.image.url),typeof e.image.ratio=="number"&&(n._pixelRatio=e.image.ratio)):(typeof e.imagePath=="string"?n._imageSrc=e.imagePath:typeof e.image=="string"&&(n._imageSrc=e.image),typeof e.imageRatio=="number"&&(n._pixelRatio=e.imageRatio)),ye(e),n}return t.prototype.load=function(){return re(this,void 0,void 0,function(){var e;return oe(this,function(n){switch(n.label){case 0:return this._imageSrc?[4,xe(this._imageSrc)]:[3,2];case 1:e=n.sent(),this.setSourceImage(e,this._pixelRatio),n.label=2;case 2:return[2]}})})},t}(ae);function xe(i){return console.debug&&console.debug("Loading image: "+i),new Promise(function(t,e){var n=new Image;n.onload=function(){console.debug&&console.debug("Image loaded: "+i),t(n)},n.onerror=function(s){console.error("Loading failed: "+i),e(s)},n.src=i})}function ye(i){"filter"in i&&console.warn("'filter' field of atlas definition is deprecated"),"cutouts"in i&&console.warn("'cutouts' field of atlas definition is deprecated"),"sprites"in i&&console.warn("'sprites' field of atlas definition is deprecated"),"factory"in i&&console.warn("'factory' field of atlas definition is deprecated"),"ratio"in i&&console.warn("'ratio' field of atlas definition is deprecated"),"imagePath"in i&&console.warn("'imagePath' field of atlas definition is deprecated"),"imageRatio"in i&&console.warn("'imageRatio' field of atlas definition is deprecated"),typeof i.image=="object"&&"url"in i.image&&console.warn("'image.url' field of atlas definition is deprecated")}function we(i){return typeof i=="object"&&vt(i)&&typeof i.width=="number"&&typeof i.height=="number"}var mt=function(){function i(t,e){this.selection=t,this.atlas=e}return i.prototype.resolve=function(t,e){if(t){if(Array.isArray(t))return this.resolve(t[0]);if(t instanceof ot)return t;if(we(t))return this.atlas?this.atlas.pipeSpriteTexture(t):lt;if(typeof t=="object"&&vt(t)&&typeof e<"u")return this.resolve(t[e]);if(typeof t=="function"&&Et(t))return this.resolve(t(e));if(typeof t=="string")return this.atlas?this.resolve(this.atlas.findSpriteDefinition(t)):lt}else return lt},i.prototype.one=function(t){return this.resolve(this.selection,t)},i.prototype.array=function(t){var e=Array.isArray(t)?t:[];if(Array.isArray(this.selection))for(var n=0;n<this.selection.length;n++)e[n]=this.resolve(this.selection[n]);else e[0]=this.resolve(this.selection);return e},i}(),lt=new(function(i){j(t,i);function t(){var e=i.call(this)||this;return e.setSourceDimension(0,0),e}return t.prototype.getWidth=function(){return 0},t.prototype.getHeight=function(){return 0},t.prototype.prerender=function(e){return!1},t.prototype.drawWithNormalizedArgs=function(e,n,s,r,o,h,c,a,f){},t.prototype.setSourceCoordinate=function(e,n){},t.prototype.setSourceDimension=function(e,n){},t.prototype.setDestinationCoordinate=function(e,n){},t.prototype.setDestinationDimension=function(e,n){},t.prototype.draw=function(){},t}(ot)),be=new mt(lt),Yt={},Bt=[];function K(i){return re(this,void 0,void 0,function(){var t;return oe(this,function(e){switch(e.label){case 0:return i instanceof Jt?t=i:t=new Jt(i),t.name&&(Yt[t.name]=t),Bt.push(t),[4,t.load()];case 1:return e.sent(),[2,t]}})})}function Ct(i){if(typeof i!="string")return new mt(i);var t=null,e=i.indexOf(":");if(e>0&&i.length>e+1){var n=Yt[i.slice(0,e)];t=n&&n.select(i.slice(e+1))}if(!t){var s=Yt[i];t=s&&s.select()}if(!t)for(var r=0;r<Bt.length&&(t=Bt[r].select(i),!t);r++);return t||(console.error("Texture not found: "+i),t=be),t}var at=function(i){j(t,i);function t(e,n){var s=i.call(this)||this;return s._source=e,s._resizeMode=n,s}return t.prototype.getWidth=function(){var e;return(e=this.dw)!==null&&e!==void 0?e:this._source.getWidth()},t.prototype.getHeight=function(){var e;return(e=this.dh)!==null&&e!==void 0?e:this._source.getHeight()},t.prototype.prerender=function(e){return!1},t.prototype.drawWithNormalizedArgs=function(e,n,s,r,o,h,c,a,f){var u=this._source;if(!(u===null||typeof u!="object")){var v=a,m=f,d=Number.isFinite(u.left)?u.left:0,_=Number.isFinite(u.right)?u.right:0,l=Number.isFinite(u.top)?u.top:0,g=Number.isFinite(u.bottom)?u.bottom:0,L=u.getWidth()-d-_,C=u.getHeight()-l-g;if(this._innerSize||(v=Math.max(v-d-_,0),m=Math.max(m-l-g,0)),l>0&&d>0&&u.draw(e,0,0,d,l,0,0,d,l),g>0&&d>0&&u.draw(e,0,C+l,d,g,0,m+l,d,g),l>0&&_>0&&u.draw(e,L+d,0,_,l,v+d,0,_,l),g>0&&_>0&&u.draw(e,L+d,C+l,_,g,v+d,m+l,_,g),this._resizeMode==="stretch")l>0&&u.draw(e,d,0,L,l,d,0,v,l),g>0&&u.draw(e,d,C+l,L,g,d,m+l,v,g),d>0&&u.draw(e,0,l,d,C,0,l,d,m),_>0&&u.draw(e,L+d,l,_,C,v+d,l,_,m),u.draw(e,d,l,L,C,d,l,v,m);else if(this._resizeMode==="tile")for(var V=d,ht=v,I=void 0;ht>0;){I=Math.min(L,ht),ht-=L;for(var J=l,Tt=m,F=void 0;Tt>0;)F=Math.min(C,Tt),Tt-=C,u.draw(e,d,l,I,F,V,J,I,F),ht<=0&&(d&&u.draw(e,0,l,d,F,0,J,d,F),_&&u.draw(e,L+d,l,_,F,V+I,J,_,F)),J+=F;l&&u.draw(e,d,0,I,l,V,0,I,l),g&&u.draw(e,d,C+l,I,g,V,J,I,g),V+=I}}},t}(ot);function Kt(){return typeof window<"u"&&window.devicePixelRatio||1}function Se(i){return i&&(i==="cover"||i==="contain"||i==="fill"||i==="in"||i==="in-pad"||i==="out"||i==="out-crop")}var p=0,Te=function(){function i(t){this.uid="pin:"+wt(),this._directionX=1,this._directionY=1,this._owner=t,this._parent=null,this._relativeMatrix=new Vt,this._absoluteMatrix=new Vt,this.reset()}return i.prototype.reset=function(){this._textureAlpha=1,this._alpha=1,this._width=0,this._height=0,this._scaleX=1,this._scaleY=1,this._skewX=0,this._skewY=0,this._rotation=0,this._pivoted=!1,this._pivotX=0,this._pivotY=0,this._handled=!1,this._handleX=0,this._handleY=0,this._aligned=!1,this._alignX=0,this._alignY=0,this._offsetX=0,this._offsetY=0,this._boxX=0,this._boxY=0,this._boxWidth=this._width,this._boxHeight=this._height,this._ts_translate=++p,this._ts_transform=++p,this._ts_matrix=++p},i.prototype._update=function(){return this._parent=this._owner._parent&&this._owner._parent._pin,this._handled&&this._mo_handle!=this._ts_transform&&(this._mo_handle=this._ts_transform,this._ts_translate=++p),this._aligned&&this._parent&&this._mo_align!=this._parent._ts_transform&&(this._mo_align=this._parent._ts_transform,this._ts_translate=++p),this},i.prototype.toString=function(){return this._owner+" ("+(this._parent?this._parent._owner:null)+")"},i.prototype.absoluteMatrix=function(){this._update();var t=Math.max(this._ts_transform,this._ts_translate,this._parent?this._parent._ts_matrix:0);if(this._mo_abs==t)return this._absoluteMatrix;this._mo_abs=t;var e=this._absoluteMatrix;return e.reset(this.relativeMatrix()),this._parent&&e.concat(this._parent._absoluteMatrix),this._ts_matrix=++p,e},i.prototype.relativeMatrix=function(){this._update();var t=Math.max(this._ts_transform,this._ts_translate,this._parent?this._parent._ts_transform:0);if(this._mo_rel==t)return this._relativeMatrix;this._mo_rel=t;var e=this._relativeMatrix;if(e.identity(),this._pivoted&&e.translate(-this._pivotX*this._width,-this._pivotY*this._height),e.scale(this._scaleX*this._directionX,this._scaleY*this._directionY),e.skew(this._skewX,this._skewY),e.rotate(this._rotation),this._pivoted&&e.translate(this._pivotX*this._width,this._pivotY*this._height),this._pivoted)this._boxX=0,this._boxY=0,this._boxWidth=this._width,this._boxHeight=this._height;else{var n=void 0,s=void 0;e.a>0&&e.c>0||e.a<0&&e.c<0?(n=0,s=e.a*this._width+e.c*this._height):(n=e.a*this._width,s=e.c*this._height),n>s?(this._boxX=s,this._boxWidth=n-s):(this._boxX=n,this._boxWidth=s-n),e.b>0&&e.d>0||e.b<0&&e.d<0?(n=0,s=e.b*this._width+e.d*this._height):(n=e.b*this._width,s=e.d*this._height),n>s?(this._boxY=s,this._boxHeight=n-s):(this._boxY=n,this._boxHeight=s-n)}return this._x=this._offsetX,this._y=this._offsetY,this._x-=this._boxX+this._handleX*this._boxWidth*this._directionX,this._y-=this._boxY+this._handleY*this._boxHeight*this._directionY,this._aligned&&this._parent&&(this._parent.relativeMatrix(),this._x+=this._alignX*this._parent._width,this._y+=this._alignY*this._parent._height),e.translate(this._x,this._y),this._relativeMatrix},i.prototype.get=function(t){if(typeof $t[t]=="function")return $t[t](this)},i.prototype.set=function(t,e){if(typeof t=="string")typeof ct[t]=="function"&&typeof e<"u"&&ct[t](this,e);else if(typeof t=="object")for(e in t)typeof ct[e]=="function"&&typeof t[e]<"u"&&ct[e](this,t[e],t);return this._owner&&(this._owner._ts_pin=++p,this._owner.touch()),this},i.prototype.fit=function(t,e,n){this._ts_transform=++p,n==="contain"&&(n="in-pad"),n==="cover"&&(n="out-crop"),typeof t=="number"&&(this._scaleX=t/this._unscaled_width,this._width=this._unscaled_width),typeof e=="number"&&(this._scaleY=e/this._unscaled_height,this._height=this._unscaled_height),typeof t=="number"&&typeof e=="number"&&typeof n=="string"&&(n==="fill"||(n==="out"||n==="out-crop"?this._scaleX=this._scaleY=Math.max(this._scaleX,this._scaleY):(n==="in"||n==="in-pad")&&(this._scaleX=this._scaleY=Math.min(this._scaleX,this._scaleY))),(n==="out-crop"||n==="in-pad")&&(this._width=t/this._scaleX,this._height=e/this._scaleY))},i}(),$t={alpha:function(i){return i._alpha},textureAlpha:function(i){return i._textureAlpha},width:function(i){return i._width},height:function(i){return i._height},boxWidth:function(i){return i._boxWidth},boxHeight:function(i){return i._boxHeight},scaleX:function(i){return i._scaleX},scaleY:function(i){return i._scaleY},skewX:function(i){return i._skewX},skewY:function(i){return i._skewY},rotation:function(i){return i._rotation},pivotX:function(i){return i._pivotX},pivotY:function(i){return i._pivotY},offsetX:function(i){return i._offsetX},offsetY:function(i){return i._offsetY},alignX:function(i){return i._alignX},alignY:function(i){return i._alignY},handleX:function(i){return i._handleX},handleY:function(i){return i._handleY}},ct={alpha:function(i,t){i._alpha=t},textureAlpha:function(i,t){i._textureAlpha=t},width:function(i,t){i._unscaled_width=t,i._width=t,i._ts_transform=++p},height:function(i,t){i._unscaled_height=t,i._height=t,i._ts_transform=++p},scale:function(i,t){i._scaleX=t,i._scaleY=t,i._ts_transform=++p},scaleX:function(i,t){i._scaleX=t,i._ts_transform=++p},scaleY:function(i,t){i._scaleY=t,i._ts_transform=++p},skew:function(i,t){i._skewX=t,i._skewY=t,i._ts_transform=++p},skewX:function(i,t){i._skewX=t,i._ts_transform=++p},skewY:function(i,t){i._skewY=t,i._ts_transform=++p},rotation:function(i,t){i._rotation=t,i._ts_transform=++p},pivot:function(i,t){i._pivotX=t,i._pivotY=t,i._pivoted=!0,i._ts_transform=++p},pivotX:function(i,t){i._pivotX=t,i._pivoted=!0,i._ts_transform=++p},pivotY:function(i,t){i._pivotY=t,i._pivoted=!0,i._ts_transform=++p},offset:function(i,t){i._offsetX=t,i._offsetY=t,i._ts_translate=++p},offsetX:function(i,t){i._offsetX=t,i._ts_translate=++p},offsetY:function(i,t){i._offsetY=t,i._ts_translate=++p},align:function(i,t){this.alignX(i,t),this.alignY(i,t)},alignX:function(i,t){i._alignX=t,i._aligned=!0,i._ts_translate=++p,this.handleX(i,t)},alignY:function(i,t){i._alignY=t,i._aligned=!0,i._ts_translate=++p,this.handleY(i,t)},handle:function(i,t){this.handleX(i,t),this.handleY(i,t)},handleX:function(i,t){i._handleX=t,i._handled=!0,i._ts_translate=++p},handleY:function(i,t){i._handleY=t,i._handled=!0,i._ts_translate=++p},resizeMode:function(i,t,e){e&&(t=="in"?t="in-pad":t=="out"&&(t="out-crop"),i.fit(e.resizeWidth,e.resizeHeight,t))},resizeWidth:function(i,t,e){(!e||!e.resizeMode)&&i.fit(t,null)},resizeHeight:function(i,t,e){(!e||!e.resizeMode)&&i.fit(null,t)},scaleMode:function(i,t,e){e&&i.fit(e.scaleWidth,e.scaleHeight,t)},scaleWidth:function(i,t,e){(!e||!e.scaleMode)&&i.fit(t,null)},scaleHeight:function(i,t,e){(!e||!e.scaleMode)&&i.fit(null,t)},matrix:function(i,t){this.scaleX(i,t.a),this.skewX(i,t.c/t.d),this.skewY(i,t.b/t.a),this.scaleY(i,t.d),this.offsetX(i,t.e),this.offsetY(i,t.f),this.rotation(i,0)}},ke=function(i){return i},Me=function(){function i(){}return i.init=function(t,e){if(typeof t=="function")return t;if(typeof t=="string"){var n;if(t.indexOf("(")===-1)n=Qt(t,e);else{var s=/^((\w|-)+)?(\((.*)\))?$/i.exec(t);if(s||s.length){var r=s[1],o=JSON.parse("["+s[4]+"]");n=Qt(r,o)}}return n}},i}(),Qt=function(i,t){var e,n=Ae[i],s=Ee[i];return n?e=n:s&&(t?e=s.apply(null,t):e=s()),e},y=function(i){return function(t){return 1-i(1-t)}},w=function(i){return function(t){return t<.5?i(2*t)/2:1-i(2*(1-t))/2}},b=function(i){return function(t){return t<.5?1-i(2*(1-t))/2:i(2*t)/2}},$=function(i){return i},Q=function(i){return i*i},Z=function(i){return i*i*i},tt=function(i){return i*i*i*i},et=function(i){return i*i*i*i*i},X=function(i){return 1-Math.cos(i*Math.PI/2)},Y=function(i){return i==0?0:Math.pow(2,10*(i-1))},B=function(i){return 1-Math.sqrt(1-i*i)},it=function(i){return i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375},nt=function(i){return function(t){return Math.pow(t,i)}},st=function(i,t){i===void 0&&(i=1),t===void 0&&(t=.45);var e=t/(2*Math.PI)*Math.asin(1/i);return function(n){return 1+i*Math.pow(2,-10*n)*Math.sin((n-e)*(2*Math.PI)/t)}},rt=function(i){return i===void 0&&(i=1.70158),function(t){return t*t*((i+1)*t-i)}},Ae={linear:$,"linear-in":$,"linear-out":y($),"linear-in-out":w($),"linear-out-in":b($),quad:Q,"quad-in":Q,"quad-out":y(Q),"quad-in-out":w(Q),"quad-out-in":b(Q),cubic:Z,"cubic-in":Z,"cubic-out":y(Z),"cubic-in-out":w(Z),"cubic-out-in":b(Z),quart:tt,"quart-in":tt,"quart-out":y(tt),"quart-in-out":w(tt),"quart-out-in":b(tt),quint:et,"quint-in":et,"quint-out":y(et),"quint-in-out":w(et),"quint-out-in":b(et),sin:X,"sin-in":X,"sin-out":y(X),"sin-in-out":w(X),"sin-out-in":b(X),sine:X,"sine-in":X,"sine-out":y(X),"sine-in-out":w(X),"sine-out-in":b(X),exp:Y,"exp-in":Y,"exp-out":y(Y),"exp-in-out":w(Y),"exp-out-in":b(Y),expo:Y,"expo-in":Y,"expo-out":y(Y),"expo-in-out":w(Y),"expo-out-in":b(Y),circle:B,"circle-in":B,"circle-out":y(B),"circle-in-out":w(B),"circle-out-in":b(B),circ:B,"circ-in":B,"circ-out":y(B),"circ-in-out":w(B),"circ-out-in":b(B),bounce:it,"bounce-in":it,"bounce-out":y(it),"bounce-in-out":w(it),"bounce-out-in":b(it)},Ee={poly:nt,"poly-in":nt,"poly-out":function(i){return y(nt(i))},"poly-in-out":function(i){return w(nt(i))},"poly-out-in":function(i){return b(nt(i))},elastic:st,"elastic-in":st,"elastic-out":function(i,t){return y(st(i,t))},"elastic-in-out":function(i,t){return w(st(i,t))},"elastic-out-in":function(i,t){return b(st(i,t))},back:rt,"back-in":rt,"back-out":function(i){return y(rt(i))},"back-in-out":function(i){return w(rt(i))},"back-out-in":function(i){return b(rt(i))}},Xe=function(){function i(t,e){e===void 0&&(e={}),this.uid="transition:"+wt(),this._ending=[],this._end={},this._duration=e.duration||400,this._delay=e.delay||0,this._owner=t,this._time=0}return i.prototype.tick=function(t,e,n,s){if(this._time+=e,!(this._time<this._delay)){var r=this._time-this._delay;if(!this._start){this._start={};for(var o in this._end)this._start[o]=this._owner._pin.get(o)}var h=Math.min(r/this._duration,1),c=h>=1;typeof this._easing=="function"&&(h=this._easing(h));var a=1-h;for(var o in this._end)this._owner._pin.set(o,this._start[o]*a+this._end[o]*h);return c}},i.prototype.finish=function(){var t=this;return this._ending.forEach(function(e){try{e.call(t._owner)}catch(n){console.error(n)}}),this._next},i.prototype.tween=function(t,e){var n;return typeof t=="object"&&t!==null?n=t:(n={},typeof t=="number"&&(n.duration=t,typeof e=="number"&&(n.delay=e))),this._next=new i(this._owner,n)},i.prototype.duration=function(t){return this._duration=t,this},i.prototype.delay=function(t){return this._delay=t,this},i.prototype.ease=function(t){for(var e,n=[],s=1;s<arguments.length;s++)n[s-1]=arguments[s];return this._easing=(e=Me.init(t,n))!==null&&e!==void 0?e:ke,this},i.prototype.done=function(t){return this._ending.push(t),this},i.prototype.hide=function(){return this._ending.push(function(){this.hide()}),this._hide=!0,this},i.prototype.remove=function(){return this._ending.push(function(){this.remove()}),this._remove=!0,this},i.prototype.pin=function(t,e){if(typeof t=="object")for(var n in t)Zt(this._owner,this._end,n,t[n]);else typeof e<"u"&&Zt(this._owner,this._end,t,e);return this},i.prototype.then=function(t){return this.done(t),this},i.prototype.clear=function(t){return this},i.prototype.size=function(t,e){return this.pin("width",t),this.pin("height",e),this},i.prototype.width=function(t){return this.pin("width",t),this},i.prototype.height=function(t){return this.pin("height",t),this},i.prototype.offset=function(t,e){return typeof t=="object"&&(e=t.y,t=t.x),this.pin("offsetX",t),this.pin("offsetY",e),this},i.prototype.rotate=function(t){return this.pin("rotation",t),this},i.prototype.skew=function(t,e){return typeof t=="object"?(e=t.y,t=t.x):typeof e>"u"&&(e=t),this.pin("skewX",t),this.pin("skewY",e),this},i.prototype.scale=function(t,e){return typeof t=="object"?(e=t.y,t=t.x):typeof e>"u"&&(e=t),this.pin("scaleX",t),this.pin("scaleY",e),this},i.prototype.alpha=function(t,e){return this.pin("alpha",t),typeof e<"u"&&this.pin("textureAlpha",e),this},i}();function Zt(i,t,e,n){typeof i._pin.get(e)=="number"?t[e]=n:typeof i._pin.get(e+"X")=="number"&&typeof i._pin.get(e+"Y")=="number"&&(t[e+"X"]=n,t[e+"Y"]=n)}var S=0;W.create=0;function k(i){if(i&&i instanceof H)return i;throw"Invalid component: "+i}function ft(){return new H}function Ye(i){return new H().column(i).label("Column")}function ce(){return new H().maximize().label("Maximize")}var H=function(){function i(){var t=this;this.uid="component:"+wt(),this._label="",this._parent=null,this._next=null,this._prev=null,this._first=null,this._last=null,this._visible=!0,this._alpha=1,this._padding=0,this._spacing=0,this._pin=new Te(this),this._listeners={},this._attrs={},this._flags={},this._transitions=[],this._tickBefore=[],this._tickAfter=[],this.MAX_ELAPSE=1/0,this.renderedBefore=!1,this._transitionTickInitied=!1,this._transitionTickLastTime=0,this._transitionTick=function(e,n,s){if(!t._transitions.length)return!1;var r=t._transitionTickLastTime!==s;if(t._transitionTickLastTime=n,r)return!0;var o=t._transitions[0],h=o.tick(t,e,n,s);if(h){o===t._transitions[0]&&t._transitions.shift();var c=o.finish();c&&t._transitions.unshift(c)}return!0},W.create++,this instanceof i&&this.label(this.constructor.name)}return i.prototype.matrix=function(t){return t===void 0&&(t=!1),t===!0?this._pin.relativeMatrix():this._pin.absoluteMatrix()},i.prototype.getPixelRatio=function(){var t,e=(t=this._parent)===null||t===void 0?void 0:t.matrix(),n=e?Math.max(Math.abs(e.a),Math.abs(e.b))/Kt():1;return n},i.prototype.getDevicePixelRatio=function(){var t,e=(t=this._parent)===null||t===void 0?void 0:t.matrix(),n=e?Math.max(Math.abs(e.a),Math.abs(e.b)):1;return n},i.prototype.getLogicalPixelRatio=function(){return this.getDevicePixelRatio()/Kt()},i.prototype.pin=function(t,e){if(typeof t=="object")return this._pin.set(t),this;if(typeof t=="string")return typeof e>"u"?this._pin.get(t):(this._pin.set(t,e),this);if(typeof t>"u")return this._pin},i.prototype.fit=function(t,e,n){var s,r,o;return typeof t=="object"?this._pin.fit((s=t.width)!==null&&s!==void 0?s:t.x,(r=t.height)!==null&&r!==void 0?r:t.y,(o=t.mode)!==null&&o!==void 0?o:e):this._pin.fit(t,e,n),this},i.prototype.scaleTo=function(t,e,n){return this.fit(t,e,n)},i.prototype.toString=function(){return"["+this._label+"]"},i.prototype.id=function(t){return typeof t>"u"?this._label:(this._label=t,this)},i.prototype.label=function(t){return typeof t>"u"?this._label:(this._label=t,this)},i.prototype.attr=function(t,e){return typeof e>"u"?this._attrs!==null?this._attrs[t]:void 0:((this._attrs!==null?this._attrs:this._attrs={})[t]=e,this)},i.prototype.visible=function(t){return typeof t>"u"?this._visible:(this._visible=t,this._parent&&(this._parent._ts_children=++S),this._ts_pin=++S,this.touch(),this)},i.prototype.hide=function(){return this.visible(!1),this},i.prototype.show=function(){return this.visible(!0),this},i.prototype.parent=function(){return this._parent},i.prototype.next=function(t){for(var e=this._next;e&&t&&!e._visible;)e=e._next;return e},i.prototype.prev=function(t){for(var e=this._prev;e&&t&&!e._visible;)e=e._prev;return e},i.prototype.first=function(t){for(var e=this._first;e&&t&&!e._visible;)e=e._next;return e},i.prototype.last=function(t){for(var e=this._last;e&&t&&!e._visible;)e=e._prev;return e},i.prototype.visit=function(t,e){var n=t.reverse,s=t.visible;if(!(t.start&&t.start(this,e))){for(var r,o=n?this.last(s):this.first(s);r=o;)if(o=n?r.prev(s):r.next(s),r.visit(t,e))return!0;return t.end&&t.end(this,e)}},i.prototype.append=function(t,e){if(Array.isArray(t))for(var n=0;n<t.length;n++)i.append(this,t[n]);else if(typeof e<"u")for(var n=0;n<arguments.length;n++)i.append(this,arguments[n]);else typeof t<"u"&&i.append(this,t);return this},i.prototype.prepend=function(t,e){if(Array.isArray(t))for(var n=t.length-1;n>=0;n--)i.prepend(this,t[n]);else if(typeof e<"u")for(var n=arguments.length-1;n>=0;n--)i.prepend(this,arguments[n]);else typeof t<"u"&&i.prepend(this,t);return this},i.prototype.appendTo=function(t){return i.append(t,this),this},i.prototype.prependTo=function(t){return i.prepend(t,this),this},i.prototype.insertNext=function(t,e){if(Array.isArray(t))for(var n=0;n<t.length;n++)i.insertAfter(t[n],this);else if(typeof e<"u")for(var n=0;n<arguments.length;n++)i.insertAfter(arguments[n],this);else typeof t<"u"&&i.insertAfter(t,this);return this},i.prototype.insertPrev=function(t,e){if(Array.isArray(t))for(var n=t.length-1;n>=0;n--)i.insertBefore(t[n],this);else if(typeof e<"u")for(var n=arguments.length-1;n>=0;n--)i.insertBefore(arguments[n],this);else typeof t<"u"&&i.insertBefore(t,this);return this},i.prototype.insertAfter=function(t){return i.insertAfter(this,t),this},i.prototype.insertBefore=function(t){return i.insertBefore(this,t),this},i.append=function(t,e){k(e),k(t),e.remove(),t._last&&(t._last._next=e,e._prev=t._last),e._parent=t,t._last=e,t._first||(t._first=e),e._parent._flag(e,!0),e._ts_parent=++S,t._ts_children=++S,t.touch()},i.prepend=function(t,e){k(e),k(t),e.remove(),t._first&&(t._first._prev=e,e._next=t._first),e._parent=t,t._first=e,t._last||(t._last=e),e._parent._flag(e,!0),e._ts_parent=++S,t._ts_children=++S,t.touch()},i.insertBefore=function(t,e){k(t),k(e),t.remove();var n=e._parent,s=e._prev;n&&(e._prev=t,s&&(s._next=t)||n&&(n._first=t),t._parent=n,t._prev=s,t._next=e,t._parent._flag(t,!0),t._ts_parent=++S,t.touch())},i.insertAfter=function(t,e){k(t),k(e),t.remove();var n=e._parent,s=e._next;n&&(e._next=t,s&&(s._prev=t)||n&&(n._last=t),t._parent=n,t._prev=e,t._next=s,t._parent._flag(t,!0),t._ts_parent=++S,t.touch())},i.prototype.remove=function(t,e){if(typeof t<"u"){if(Array.isArray(t))for(var n=0;n<t.length;n++)k(t[n]).remove();else if(typeof e<"u")for(var n=0;n<arguments.length;n++)k(arguments[n]).remove();else k(t).remove();return this}return this._prev&&(this._prev._next=this._next),this._next&&(this._next._prev=this._prev),this._parent&&(this._parent._first===this&&(this._parent._first=this._next),this._parent._last===this&&(this._parent._last=this._prev),this._parent._flag(this,!1),this._parent._ts_children=++S,this._parent.touch()),this._prev=this._next=this._parent=null,this._ts_parent=++S,this},i.prototype.empty=function(){for(var t=null,e=this._first;t=e;)e=t._next,t._prev=t._next=t._parent=null,this._flag(t,!1);return this._first=this._last=null,this._ts_children=++S,this.touch(),this},i.prototype.touch=function(){return this._ts_touch=++S,this._parent&&this._parent.touch(),this},i.prototype._flag=function(t,e){if(typeof e>"u")return this._flags!==null&&this._flags[t]||0;if(typeof t=="string"&&(e?(this._flags=this._flags||{},!this._flags[t]&&this._parent&&this._parent._flag(t,!0),this._flags[t]=(this._flags[t]||0)+1):this._flags&&this._flags[t]>0&&(this._flags[t]==1&&this._parent&&this._parent._flag(t,!1),this._flags[t]=this._flags[t]-1)),typeof t=="object"&&t._flags)for(var n in t._flags)t._flags[n]>0&&this._flag(n,e);return this},i.prototype.hitTest=function(t){var e=this._pin._width,n=this._pin._height;return t.x>=0&&t.x<=e&&t.y>=0&&t.y<=n},i.prototype.prerender=function(){if(this._visible){this.prerenderTexture();for(var t,e=this._first;t=e;)e=t._next,t.prerender()}},i.prototype.prerenderTexture=function(){},i.prototype.render=function(t){if(this._visible){W.component++;var e=this.matrix();t.setTransform(e.a,e.b,e.c,e.d,e.e,e.f),this._alpha=this._pin._alpha*(this._parent?this._parent._alpha:1);var n=this._pin._textureAlpha*this._alpha;t.globalAlpha!=n&&(t.globalAlpha=n),this.renderedBefore||this.prerenderTexture(),this.renderedBefore=!0,this.renderTexture(t),t.globalAlpha!=this._alpha&&(t.globalAlpha=this._alpha);for(var s,r=this._first;s=r;)r=s._next,s.render(t)}},i.prototype.renderTexture=function(t){},i.prototype._tick=function(t,e,n){if(this._visible){t>this.MAX_ELAPSE&&(t=this.MAX_ELAPSE);var s=!1;if(this._tickBefore!==null)for(var r=0;r<this._tickBefore.length;r++){W.tick++;var o=this._tickBefore[r];s=o.call(this,t,e,n)===!0||s}for(var h,c=this._first;h=c;)c=h._next,h._flag("_tick")&&(s=h._tick(t,e,n)===!0?!0:s);if(this._tickAfter!==null)for(var r=0;r<this._tickAfter.length;r++){W.tick++;var o=this._tickAfter[r];s=o.call(this,t,e,n)===!0||s}return s}},i.prototype.tick=function(t,e){var n,s;if(e===void 0&&(e=!1),typeof t=="function"){e?(this._tickBefore===null&&(this._tickBefore=[]),this._tickBefore.push(t)):(this._tickAfter===null&&(this._tickAfter=[]),this._tickAfter.push(t));var r=((n=this._tickAfter)===null||n===void 0?void 0:n.length)>0||((s=this._tickBefore)===null||s===void 0?void 0:s.length)>0;this._flag("_tick",r)}},i.prototype.untick=function(t){if(typeof t=="function"){var e;this._tickBefore!==null&&(e=this._tickBefore.indexOf(t))>=0&&this._tickBefore.splice(e,1),this._tickAfter!==null&&(e=this._tickAfter.indexOf(t))>=0&&this._tickAfter.splice(e,1)}},i.prototype.timeout=function(t,e){this.setTimeout(t,e)},i.prototype.setTimeout=function(t,e){function n(s){if((e-=s)<0)this.untick(n),t.call(this);else return!0}return this.tick(n),n},i.prototype.clearTimeout=function(t){this.untick(t)},i.prototype.on=function(t,e){if(!t||!t.length||typeof e!="function")return this;if(typeof t!="string"&&typeof t.join=="function")for(var n=0;n<t.length;n++)this.on(t[n],e);else if(typeof t=="string"&&t.indexOf(" ")>-1){t=t.match(/\S+/g);for(var n=0;n<t.length;n++)this._on(t[n],e)}else typeof t=="string"&&this._on(t,e);return this},i.prototype._on=function(t,e){typeof t!="string"&&typeof e!="function"||(this._listeners[t]=this._listeners[t]||[],this._listeners[t].push(e),this._flag(t,!0))},i.prototype.off=function(t,e){if(!t||!t.length||typeof e!="function")return this;if(typeof t!="string"&&typeof t.join=="function")for(var n=0;n<t.length;n++)this.off(t[n],e);else if(typeof t=="string"&&t.indexOf(" ")>-1){t=t.match(/\S+/g);for(var n=0;n<t.length;n++)this._off(t[n],e)}else typeof t=="string"&&this._off(t,e);return this},i.prototype._off=function(t,e){if(!(typeof t!="string"&&typeof e!="function")){var n=this._listeners[t];if(!(!n||!n.length)){var s=n.indexOf(e);s>=0&&(n.splice(s,1),this._flag(t,!1))}}},i.prototype.listeners=function(t){return this._listeners[t]},i.prototype.publish=function(t,e){var n=this.listeners(t);if(!n||!n.length)return 0;for(var s=0;s<n.length;s++)n[s].apply(this,e);return n.length},i.prototype.trigger=function(t,e){return this.publish(t,e),this},i.prototype.size=function(t,e){return this.pin("width",t),this.pin("height",e),this},i.prototype.width=function(t){return typeof t>"u"?this.pin("width"):(this.pin("width",t),this)},i.prototype.height=function(t){return typeof t>"u"?this.pin("height"):(this.pin("height",t),this)},i.prototype.offset=function(t,e){return typeof t=="object"&&(e=t.y,t=t.x),this.pin("offsetX",t),this.pin("offsetY",e),this},i.prototype.rotate=function(t){return this.pin("rotation",t),this},i.prototype.skew=function(t,e){return typeof t=="object"?(e=t.y,t=t.x):typeof e>"u"&&(e=t),this.pin("skewX",t),this.pin("skewY",e),this},i.prototype.scale=function(t,e){return typeof t=="object"?(e=t.y,t=t.x):typeof e>"u"&&(e=t),this.pin("scaleX",t),this.pin("scaleY",e),this},i.prototype.alpha=function(t,e){return this.pin("alpha",t),typeof e<"u"&&this.pin("textureAlpha",e),this},i.prototype.tween=function(t,e,n){var s;typeof t=="object"&&t!==null?s=t:(s={},typeof t=="number"?(s.duration=t,typeof e=="number"?(s.delay=e,typeof n=="boolean"&&(s.append=n)):typeof e=="boolean"&&(s.append=e)):typeof t=="boolean"&&(s.append=t)),this._transitionTickInitied||(this.tick(this._transitionTick,!0),this._transitionTickInitied=!0),this.touch(),s.append||(this._transitions.length=0);var r=new Xe(this,s);return this._transitions.push(r),r},i.prototype.row=function(t){return this.align("row",t),this},i.prototype.column=function(t){return this.align("column",t),this},i.prototype.align=function(t,e){var n=this;return this._padding=this._padding,this._spacing=this._spacing,this._layoutTicker&&this.untick(this._layoutTicker),this.tick(this._layoutTicker=function(){if(n._mo_seq!=n._ts_touch){n._mo_seq=n._ts_touch;var s=n._mo_seqAlign!=n._ts_children;n._mo_seqAlign=n._ts_children;for(var r=0,o=0,h,c=n.first(!0),a=!0;h=c;){c=h.next(!0),h.matrix(!0);var f=h.pin("boxWidth"),u=h.pin("boxHeight");t=="column"?(!a&&(o+=n._spacing),h.pin("offsetY")!=o&&h.pin("offsetY",o),r=Math.max(r,f),o=o+u,s&&h.pin("alignX",e)):t=="row"&&(!a&&(r+=n._spacing),h.pin("offsetX")!=r&&h.pin("offsetX",r),r=r+f,o=Math.max(o,u),s&&h.pin("alignY",e)),a=!1}r+=2*n._padding,o+=2*n._padding,n.pin("width")!=r&&n.pin("width",r),n.pin("height")!=o&&n.pin("height",o)}}),this},i.prototype.box=function(){return this.minimize()},i.prototype.layer=function(){return this.maximize()},i.prototype.minimize=function(){var t=this;return this._padding=this._padding,this._layoutTicker&&this.untick(this._layoutTicker),this.tick(this._layoutTicker=function(){if(t._mo_box!=t._ts_touch){t._mo_box=t._ts_touch;for(var e=0,n=0,s,r=t.first(!0);s=r;){r=s.next(!0),s.matrix(!0);var o=s.pin("boxWidth"),h=s.pin("boxHeight");e=Math.max(e,o),n=Math.max(n,h)}e+=2*t._padding,n+=2*t._padding,t.pin("width")!=e&&t.pin("width",e),t.pin("height")!=n&&t.pin("height",n)}}),this},i.prototype.maximize=function(){var t=this;return this._layoutTicker&&this.untick(this._layoutTicker),this.tick(this._layoutTicker=function(){var e=t.parent();if(e){var n=e.pin("width");t.pin("width")!=n&&t.pin("width",n);var s=e.pin("height");t.pin("height")!=s&&t.pin("height",s)}},!0),this},i.prototype.padding=function(t){return this._padding=t,this},i.prototype.spacing=function(t){return this._spacing=t,this},i}();function gt(i){var t=new ue;return i&&t.texture(i),t}var ue=function(i){j(t,i);function t(){var e=i.call(this)||this;return e._texture=null,e._image=null,e._tiled=!1,e._stretched=!1,e.prerenderContext={},e.label("Sprite"),e}return t.prototype.texture=function(e){return this._image=Ct(e).one(),this._image?(this.pin("width",this._image.getWidth()),this.pin("height",this._image.getHeight()),this._tiled?this._texture=new at(this._image,"tile"):this._stretched?this._texture=new at(this._image,"stretch"):this._texture=new Xt(this._image)):(this.pin("width",0),this.pin("height",0),this._texture=null),this},t.prototype.image=function(e){return this.texture(e)},t.prototype.tile=function(e){this._tiled=!0;var n=new at(this._image,"tile");return this._texture=n,this},t.prototype.stretch=function(e){this._stretched=!0;var n=new at(this._image,"stretch");return this._texture=n,this},t.prototype.prerenderTexture=function(){if(this._image){var e=this.getDevicePixelRatio();this.prerenderContext.pixelRatio=e;var n=this._image.prerender(this.prerenderContext);if(n===!0){var s=this._image.getWidth(),r=this._image.getHeight();this.size(s,r)}}},t.prototype.renderTexture=function(e){this._texture&&(this._texture._resizeMode&&(this._texture.dw=this.pin("width"),this._texture.dh=this.pin("height")),this._texture.draw(e))},t}(H);(function(i){j(t,i);function t(){var e=i.call(this,document.createElement("canvas"))||this;return e._lastPixelRatio=0,e}return t.prototype.setSize=function(e,n,s){s===void 0&&(s=1),this._source.width=e*s,this._source.height=n*s,this._pixelRatio=s},t.prototype.getContext=function(e,n){return e===void 0&&(e="2d"),this._source.getContext(e,n)},t.prototype.getDevicePixelRatio=function(){return this._lastPixelRatio},t.prototype.getOptimalPixelRatio=function(){return this.getDevicePixelRatio()},t.prototype.setMemoizer=function(e){this._memoizer=e},t.prototype.setDrawer=function(e){this._drawer=e},t.prototype.prerender=function(e){var n=e.pixelRatio,s=this._lastPixelRatio,r=s/n,o=s===0||r>1.25||r<.8;o&&(this._lastPixelRatio=n);var h=this._memoizer?this._memoizer.call(this):null,c=this._lastMemoKey!==h;if(o||c)return this._lastMemoKey=h,this._lastPixelRatio=n,typeof this._drawer=="function"&&this._drawer.call(this),!0},t.prototype.size=function(e,n,s){return this.setSize(e,n,s),this},t.prototype.context=function(e,n){return e===void 0&&(e="2d"),this.getContext(e,n)},t.prototype.canvas=function(e){return typeof e=="function"?e.call(this,this.getContext()):typeof e>"u"&&typeof this._drawer=="function"&&this._drawer.call(this),this},t})(ae);var dt="click",Be="touchstart mousedown",Pe="touchmove mousemove",Re="touchend mouseup",je="touchcancel mousecancel",Le=function(){function i(){}return i.prototype.clone=function(t){return t?(t.x=this.x,t.y=this.y):t={x:this.x,y:this.y},t},i.prototype.toString=function(){return(this.x|0)+"x"+(this.y|0)},i}(),Ce=function(){function i(){this.abs=new Le}return i.prototype.clone=function(t){return t?(t.x=this.x,t.y=this.y):t={x:this.x,y:this.y},t},i.prototype.toString=function(){return this.type+": "+(this.x|0)+"x"+(this.y|0)},i}(),Ie=function(){function i(){this.type="",this.x=0,this.y=0,this.timeStamp=-1,this.event=null,this.root=null,this.collected=null}return i.prototype.toString=function(){return this.type+": "+(this.x|0)+"x"+(this.y|0)},i}(),O=new Ce,ut=new Ie,De=function(){function i(){var t=this;this.ratio=1,this.clickList=[],this.cancelList=[],this.handleStart=function(e){i.DEBUG&&console.debug&&console.debug("pointer-start",e.type),e.preventDefault(),t.localPoint(e),t.dispatchEvent(e.type,e),t.findTargets("click",t.clickList),t.findTargets("mousecancel",t.cancelList)},this.handleMove=function(e){e.preventDefault(),t.localPoint(e),t.dispatchEvent(e.type,e)},this.handleEnd=function(e){var n;e.preventDefault(),i.DEBUG&&console.debug&&console.debug("pointer-end",e.type),t.dispatchEvent(e.type,e),t.clickList.length&&(i.DEBUG&&console.debug&&console.debug("pointer-click: ",e.type,(n=t.clickList)===null||n===void 0?void 0:n.length),t.dispatchEvent("click",e,t.clickList)),t.cancelList.length=0},this.handleCancel=function(e){var n;t.cancelList.length&&(i.DEBUG&&console.debug&&console.debug("pointer-cancel",e.type,(n=t.clickList)===null||n===void 0?void 0:n.length),t.dispatchEvent("mousecancel",e,t.cancelList)),t.clickList.length=0},this.visitStart=function(e,n){return!e._flag(n.type)},this.visitEnd=function(e,n){O.raw=n.event,O.type=n.type,O.timeStamp=n.timeStamp,O.abs.x=n.x,O.abs.y=n.y;var s=e.listeners(n.type);if(s){e.matrix().inverse().map(n,O);var r=e===n.root||e.attr("spy")||e.hitTest(O);if(r&&(n.collected&&n.collected.push(e),n.event)){for(var o=!1,h=0;h<s.length;h++)o=s[h].call(e,O)?!0:o;return o}}}}return i.prototype.mount=function(t,e){var n=this;return this.stage=t,this.elem=e,this.ratio=t.viewport().ratio||1,t.on("viewport",function(s){var r;n.ratio=(r=s.ratio)!==null&&r!==void 0?r:n.ratio}),e.addEventListener("touchstart",this.handleStart),e.addEventListener("touchend",this.handleEnd),e.addEventListener("touchmove",this.handleMove),e.addEventListener("touchcancel",this.handleCancel),e.addEventListener("mousedown",this.handleStart),e.addEventListener("mouseup",this.handleEnd),e.addEventListener("mousemove",this.handleMove),document.addEventListener("mouseup",this.handleCancel),window.addEventListener("blur",this.handleCancel),this},i.prototype.unmount=function(){var t=this.elem;return t.removeEventListener("touchstart",this.handleStart),t.removeEventListener("touchend",this.handleEnd),t.removeEventListener("touchmove",this.handleMove),t.removeEventListener("touchcancel",this.handleCancel),t.removeEventListener("mousedown",this.handleStart),t.removeEventListener("mouseup",this.handleEnd),t.removeEventListener("mousemove",this.handleMove),document.removeEventListener("mouseup",this.handleCancel),window.removeEventListener("blur",this.handleCancel),this},i.prototype.localPoint=function(t){var e,n=this.elem,s,r;!((e=t.touches)===null||e===void 0)&&e.length?(s=t.touches[0].clientX,r=t.touches[0].clientY):(s=t.clientX,r=t.clientY);var o=n.getBoundingClientRect();s-=o.left,r-=o.top,s-=n.clientLeft|0,r-=n.clientTop|0,ut.x=s*this.ratio,ut.y=r*this.ratio},i.prototype.findTargets=function(t,e){var n=ut;n.type=t,n.root=this.stage,n.event=null,n.collected=e,n.collected.length=0,this.stage.visit({reverse:!0,visible:!0,start:this.visitStart,end:this.visitEnd},n)},i.prototype.dispatchEvent=function(t,e,n){var s=ut;if(s.type=t,s.root=this.stage,s.event=e,s.timeStamp=Date.now(),s.collected=null,t!=="mousemove"&&t!=="touchmove"&&i.DEBUG&&console.debug&&console.debug("pointer:dispatchEvent",s,n==null?void 0:n.length),n){for(;n.length;){var r=n.shift();if(this.visitEnd(r,s))break}n.length=0}else this.stage.visit({reverse:!0,visible:!0,start:this.visitStart,end:this.visitEnd},s)},i.DEBUG=!1,i}();function Fe(i){i===void 0&&(i={});var t=new Oe;return t.mount(i),t.pointer=new De().mount(t,t.dom),t}var Oe=function(i){j(t,i);function t(){var e=i.call(this)||this;return e.canvas=null,e.dom=null,e.context=null,e.pixelWidth=-1,e.pixelHeight=-1,e.pixelRatio=1,e.drawingWidth=0,e.drawingHeight=0,e.mounted=!1,e.paused=!1,e.sleep=!1,e.mount=function(n){if(n===void 0&&(n={}),typeof n.canvas=="string"?(e.canvas=document.getElementById(n.canvas),e.canvas||console.error("Canvas element not found: ",n.canvas)):n.canvas instanceof HTMLCanvasElement?e.canvas=n.canvas:n.canvas&&console.error("Unknown value for canvas:",n.canvas),e.canvas||(e.canvas=document.getElementById("cutjs")||document.getElementById("stage")),!e.canvas){console.debug&&console.debug("Creating canvas element..."),e.canvas=document.createElement("canvas"),Object.assign(e.canvas.style,{position:"absolute",display:"block",top:"0",left:"0",bottom:"0",right:"0",width:"100%",height:"100%"});var s=document.body;s.insertBefore(e.canvas,s.firstChild)}e.dom=e.canvas,e.context=e.canvas.getContext("2d"),e.devicePixelRatio=window.devicePixelRatio||1,e.backingStoreRatio=e.context.webkitBackingStorePixelRatio||e.context.mozBackingStorePixelRatio||e.context.msBackingStorePixelRatio||e.context.oBackingStorePixelRatio||e.context.backingStorePixelRatio||1,e.pixelRatio=e.devicePixelRatio/e.backingStoreRatio,e.mounted=!0,e.requestFrame()},e.frameRequested=!1,e.requestFrame=function(){e.frameRequested||(e.frameRequested=!0,requestAnimationFrame(e.onFrame))},e._lastFrameTime=0,e._mo_touch=null,e.onFrame=function(n){if(e.frameRequested=!1,!(!e.mounted||!e.canvas||!e.context)){e.requestFrame();var s=e.canvas.clientWidth,r=e.canvas.clientHeight;(e.pixelWidth!==s||e.pixelHeight!==r)&&(e.pixelWidth=s,e.pixelHeight=r,e.drawingWidth=s*e.pixelRatio,e.drawingHeight=r*e.pixelRatio,(e.canvas.width!==e.drawingWidth||e.canvas.height!==e.drawingHeight)&&(e.canvas.width=e.drawingWidth,e.canvas.height=e.drawingHeight,console.debug&&console.debug("Resize: ["+e.drawingWidth+", "+e.drawingHeight+"] = "+e.pixelRatio+" x ["+e.pixelWidth+", "+e.pixelHeight+"]"),e.viewport({width:e.drawingWidth,height:e.drawingHeight,ratio:e.pixelRatio})));var o=e._lastFrameTime||n,h=n-o;if(!(!e.mounted||e.paused||e.sleep)){e._lastFrameTime=n,e.prerender();var c=e._tick(h,n,o);e._mo_touch!=e._ts_touch?(e._mo_touch=e._ts_touch,e.sleep=!1,e.drawingWidth>0&&e.drawingHeight>0&&(e.context.setTransform(1,0,0,1,0,0),e.context.clearRect(0,0,e.drawingWidth,e.drawingHeight),e.debugDrawAxis>0&&e.renderDebug(e.context),e.render(e.context))):c?e.sleep=!1:e.sleep=!0,W.fps=h?1e3/h:0}}},e.debugDrawAxis=0,e.label("Root"),e}return t.prototype.renderDebug=function(e){var n=typeof this.debugDrawAxis=="number"?this.debugDrawAxis:10,s=this.matrix();e.setTransform(s.a,s.b,s.c,s.d,s.e,s.f);var r=3/s.a;e.beginPath(),e.moveTo(0,0),e.lineTo(0,.8*n),e.lineTo(-.2*n,.8*n),e.lineTo(0,n),e.lineTo(.2*n,.8*n),e.lineTo(0,.8*n),e.strokeStyle="rgba(93, 173, 226)",e.lineJoin="round",e.lineCap="round",e.lineWidth=r,e.stroke(),e.beginPath(),e.moveTo(0,0),e.lineTo(.8*n,0),e.lineTo(.8*n,-.2*n),e.lineTo(n,0),e.lineTo(.8*n,.2*n),e.lineTo(.8*n,0),e.strokeStyle="rgba(236, 112, 99)",e.lineJoin="round",e.lineCap="round",e.lineWidth=r,e.stroke()},t.prototype.resume=function(){return(this.sleep||this.paused)&&this.requestFrame(),this.paused=!1,this.sleep=!1,this.publish("resume"),this},t.prototype.pause=function(){return this.paused||this.publish("pause"),this.paused=!0,this},t.prototype.touch=function(){return(this.sleep||this.paused)&&this.requestFrame(),this.sleep=!1,i.prototype.touch.call(this)},t.prototype.unmount=function(){var e;return this.mounted=!1,(e=this.pointer)===null||e===void 0||e.unmount(),this},t.prototype.background=function(e){return this.dom&&(this.dom.style.backgroundColor=e),this},t.prototype.viewport=function(e,n,s){if(typeof e>"u")return Object.assign({},this._viewport);if(typeof e=="object"){var r=e;e=r.width,n=r.height,s=r.ratio}if(typeof e=="number"&&typeof n=="number"){this._viewport={width:e,height:n,ratio:typeof s=="number"?s:1},this.viewbox();var o=Object.assign({},this._viewport);this.visit({start:function(h){if(!h._flag("viewport"))return!0;h.publish("viewport",[o])}})}return this},t.prototype.viewbox=function(e,n,s){return typeof e=="number"&&typeof n=="number"?this._viewbox={width:e,height:n,mode:s}:typeof e=="object"&&e!==null&&(this._viewbox=At({},e)),this.rescale(),this},t.prototype.camera=function(e){return this._camera=e,this.rescale(),this},t.prototype.rescale=function(){var e=this._viewbox,n=this._viewport,s=this._camera;if(n&&e){var r=n.width,o=n.height,h=Se(e.mode)?e.mode:"in-pad",c=e.width,a=e.height;this.pin({width:c,height:a}),this.fit(r,o,h);var f=e.x||0,u=e.y||0,v=(s==null?void 0:s.a)||1,m=(s==null?void 0:s.d)||1,d=(s==null?void 0:s.e)||0,_=(s==null?void 0:s.f)||0,l=this.pin("scaleX"),g=this.pin("scaleY");this.pin("scaleX",l*v),this.pin("scaleY",g*m),this.pin("offsetX",d-f*l*v),this.pin("offsetY",_-u*g*m)}else n&&this.pin({width:n.width,height:n.height});return this},t.prototype.flipX=function(e){return this._pin._directionX=e?-1:1,this},t.prototype.flipY=function(e){return this._pin._directionY=e?-1:1,this},t}(H);function He(i,t){var e=new We;return e.frames(i).gotoFrame(0),t&&e.fps(t),e}var te=15,We=function(i){j(t,i);function t(){var e=i.call(this)||this;return e._texture=null,e._frames=[],e._time=-1,e._repeat=0,e._index=0,e._animTickLastTime=0,e._animTick=function(n,s,r){if(!(e._time<0||e._frames.length<=1)){var o=e._animTickLastTime!=r;if(e._animTickLastTime=s,o||(e._time+=n,e._time<e._ft))return!0;var h=e._time/e._ft|0;return e._time-=h*e._ft,e.moveFrame(h),e._repeat>0&&(e._repeat-=h)<=0?(e.stop(),e._callback&&e._callback(),!1):!0}},e.label("Anim"),e._fps=te,e._ft=1e3/e._fps,e.tick(e._animTick,!1),e}return t.prototype.renderTexture=function(e){this._texture&&this._texture.draw(e)},t.prototype.fps=function(e){return typeof e>"u"?this._fps:(this._fps=e>0?e:te,this._ft=1e3/this._fps,this)},t.prototype.setFrames=function(e){return this.frames(e)},t.prototype.frames=function(e){return this._index=0,this._frames=Ct(e).array(),this.touch(),this},t.prototype.length=function(){return this._frames?this._frames.length:0},t.prototype.gotoFrame=function(e,n){return n===void 0&&(n=!1),this._index=U.wrap(e,this._frames.length)|0,n=n||!this._texture,this._texture=this._frames[this._index],n&&(this.pin("width",this._texture.getWidth()),this.pin("height",this._texture.getHeight())),this.touch(),this},t.prototype.moveFrame=function(e){return this.gotoFrame(this._index+e)},t.prototype.repeat=function(e,n){return this._repeat=e*this._frames.length-1,this._callback=n,this.play(),this},t.prototype.play=function(e){return typeof e<"u"?(this.gotoFrame(e),this._time=0):this._time<0&&(this._time=0),this.touch(),this},t.prototype.stop=function(e){return this._time=-1,typeof e<"u"&&this.gotoFrame(e),this},t}(H);function z(i){return new le().frames(i)}var le=function(i){j(t,i);function t(){var e=i.call(this)||this;return e._textures=[],e.label("Monotype"),e}return t.prototype.renderTexture=function(e){if(!(!this._textures||!this._textures.length))for(var n=0,s=this._textures.length;n<s;n++)this._textures[n].draw(e)},t.prototype.setFont=function(e){return this.frames(e)},t.prototype.frames=function(e){if(this._textures=[],typeof e=="string"){var n=Ct(e);this._font=function(s){return n.one(s)}}else typeof e=="object"?this._font=function(s){return e[s]}:typeof e=="function"&&(this._font=e);return this},t.prototype.setValue=function(e){return this.value(e)},t.prototype.value=function(e){if(typeof e>"u")return this._value;if(this._value===e)return this;this._value=e,e===null?e="":typeof e!="string"&&!Array.isArray(e)&&(e=e.toString()),this._spacing=this._spacing||0;for(var n=0,s=0,r=0;r<e.length;r++){var o=e[r],h=this._textures[r]=this._font(typeof o=="string"?o:o+"");n+=r>0?this._spacing:0,h.setDestinationCoordinate(n,0),n=n+h.getWidth(),s=Math.max(s,h.getHeight())}return this.pin("width",n),this.pin("height",s),this._textures.length=e.length,this},t}(H);class Ge extends x{constructor(){super(),this.lastTime=0,this.event={dt:0,now:0},this.handleFrame=()=>{if(!this.activated)return;const t=performance.now(),e=t-this.lastTime;this.lastTime=t,this.event.now=t,this.event.dt=e,this.emit("frame-update",this.event),this.emit("frame-render",this.event),this.requestFrame()},this.requestFrame=()=>{this.activated&&window.requestAnimationFrame(this.handleFrame)},this.on("activate",this.handleActivate),this.on("deactivate",this.handleDeactivate)}handleActivate(){this.lastTime=performance.now(),this.requestFrame()}handleDeactivate(){}}class Ue{constructor(){this.state="idle",this.topScore=0,this.currentScore=0,this.newScore=0}}class It extends x{constructor(){super(),this.handleActivate=()=>{this.context.status=new Ue},this.handleFrameUpdate=t=>{const e=this.context.status;typeof e.timer=="number"&&e.timer>0&&(e.timer=Math.max(0,e.timer-t.dt),e.timer<=0&&this.emit("board-time-over"))},this.handleGameStart=()=>{this.context.status.state="playing",this.context.status.currentScore=0},this.handleGameEnd=()=>{this.context.status.state="gameover",this.context.status.newScore=0},this.handleSetTimer=t=>{this.context.status.timer=t*1e3},this.handleAddScore=t=>{this.handleSetScore(this.context.status.currentScore+t)},this.handleSetScore=t=>{const e=this.context.status,n=t-e.currentScore;e.currentScore=t,e.newScore=n},this.on("activate",this.handleActivate),this.on("frame-update",this.handleFrameUpdate),this.on("board-add-score",this.handleAddScore),this.on("board-set-score",this.handleSetScore),this.on("board-set-timer",this.handleSetTimer),this.on("game-start",this.handleGameStart),this.on("game-end",this.handleGameEnd)}}const ze="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let fe=(i=21)=>{let t="",e=crypto.getRandomValues(new Uint8Array(i|=0));for(;i--;)t+=ze[e[i]&63];return t};class Dt{constructor(t){this.key="tile-"+fe(8),this.type="tile",this.selected=!1,this.collected=!1,this.slide=!1,this.jump=!1,this.color=t}}class Ne{constructor(t,e){this.key="cell-"+fe(8),this.type="cell",this.isColored=()=>this.tile&&this.tile.color&&this.tile.color!=G.x,this.i=t,this.j=e,this.x=t*Math.sin(Math.PI/3),this.y=e+t/2}}class Ft{constructor(){this.cellMap={},this.cells=[],this.tiles=[],this.inited=!1,this.locked=!1,this.timeline=[]}}const Ot=(i,t)=>{i.inited=!0,i.cellMap={},i.cells=[],i.tiles=[];let e=[];e.push(P(i,0,0,!0));const n=[];Rt(t-1).forEach(()=>{e.forEach(s=>{R.ij.forEach(r=>{const o=s.i+r.i,h=s.j+r.j;P(i,o,h)||n.push(P(i,o,h,!0))})}),e=n}),i.locked=!1},q=i=>{i.inited=!1,i.locked=!0,i.cells.forEach(t=>{St(i,t,!1)}),i.cells=[],i.tiles=[],i.cellMap={}},P=(i,t,e,n)=>{const s=t+"-"+e;let r=i.cellMap[s];return r||!n||(r=new Ne(t,e),i.cells.push(r),i.cellMap[s]=r),r},xt=(i,t,e,n=1)=>{const s=t-n,r=t+n,o=e-n,h=e+n;let c=n*n,a=null;return i.cells.forEach(f=>{if(s<=f.x&&f.x<=r&&o<=f.y&&f.y<=h){const u=f.x-t,v=f.y-e,m=u*u+v*v;m<c&&(c=m,a=f)}}),a},qe=(i,t,e)=>{const n=R.get_ij(e),s=[t];let r;for(let o=1;r=P(i,t.i+o*n.i,t.j+o*n.j);o++)s.push(r);for(let o=-1;r=P(i,t.i+o*n.i,t.j+o*n.j);o--)s.unshift(r);return s},Ve=i=>i.cells.filter(t=>t.tile),Ht=i=>i.cells.filter(t=>!t.tile),Je=(i,t,e)=>{if(i.locked)return;let n;i.nextTiles&&i.nextTiles.length?n=i.nextTiles:n=Rt(t).map(()=>G.random());let s=0;return Qe(Ht(i)).slice(0,n.length).forEach((o,h)=>{s++,bt(i,o,new Dt(n[h]))}),i.nextTiles=Rt(t).map(()=>G.random()),s},yt=(i,t)=>{i.locked||i.cells.forEach(e=>{e.tile||bt(i,e,new Dt(G.random()))})},Ke=(i,t,e,n)=>{if(i.locked||!n)return;n<0&&(e=(e+3)%6,n=-n);const s=qe(i,t,e);for(let r=0;r<n;r++){let o=s[0];const h=St(i,o,!1);h.slide=!1,h.jump=!0;for(let c=1;c<s.length;c++){const a=s[c];Wt(i,o,a,!0),o=a}bt(i,o,h)}},$e=(i,t)=>{if(i.locked)return;const e=R.get_ij(t),n=Ht(i);let s=!0;for(;s;){s=!1;for(let r=0;r<n.length;r++){const o=n[r],h=P(i,o.i+e.i,o.j+e.j);h&&h.tile&&(Wt(i,o,h,!0),n[r]=h,s=!0)}}},Pt=(i,t,e=[],n)=>{if(!i.locked)return t.isColored()&&(n?n==t.tile.color&&(e.push(t),R.ij.forEach(s=>{const r=P(i,t.i+s.i,t.j+s.j);!r||e.includes(r)||Pt(i,r,e,n)})):(n=t.tile.color,e.push(t),R.ij.forEach(s=>{const r=P(i,t.i+s.i,t.j+s.j);!r||e.includes(r)||Pt(i,r,e,n)}))),e},de=(i,t)=>{if(i.locked)return 0;const e=[];i.cells.forEach(s=>{s.isColored()&&R.ij.forEach(r=>{var h;const o=[s];for(let c=1;c<t;c++){const a=P(i,s.i+c*r.i,s.j+c*r.j);if(!a||!a.tile||a.tile.color!=((h=s.tile)==null?void 0:h.color))break;o.push(a)}o.length>=t&&e.push(o)})});let n=0;return e.forEach(s=>{s.forEach(r=>{St(i,r,!0)&&n++})}),n},bt=(i,t,e)=>{t.tile=e,t.tile&&(t.tile.slide=!1,t.tile.cell=t,i.tiles.push(t.tile))},Wt=(i,t,e,n)=>{if(!e.tile)return null;t.tile=e.tile,e.tile=null,t.tile.slide=n,t.tile.cell=t},St=(i,t,e)=>{const n=t.tile;if(!n)return null;n.collected=e,n.cell=null,t.tile=null;const s=i.tiles.indexOf(n);return s!==-1&&i.tiles.splice(s,1),n},M=class M{static random(){return M.all[Math.random()*M.all.length|0]}};M.all=["y","b","r","g","p"],M.x="x",M.y="y",M.b="b",M.r="r",M.g="g",M.p="p";let G=M;const A=class A{};A.all=[0,1,2,3,4,5],A.ij=[{i:-1,j:0},{i:0,j:-1},{i:1,j:-1},{i:1,j:0},{i:0,j:1},{i:-1,j:1}],A.get_ij=t=>(t=t>=6?t%6:t<0?t%6+6:t,A.ij[t]),A.xy=A.all.map(t=>{const e=(t+.5)*Math.PI/3;return{x:Math.cos(e),y:Math.sin(e)}}),A.get_xy=t=>(t=t>=6?t%6:t<0?t%6+6:t,A.xy[t]),A.fromXY=(t,e)=>{let n=Math.round(Math.atan2(e,t)*3/Math.PI-.5);return n=n>=6?n%6:n<0?n%6+6:n,n};let R=A;const Qe=i=>{for(let t=i.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1)),n=i[t];i[t]=i[e],i[e]=n}return i},Rt=(i,t)=>{t===void 0&&(t=i-1,i=0);for(var e=[],n=i;n<=t;n++)e.push(n);return e},Gt=(i,t)=>{const e=i.timeline;if(!e.length)return!1;let n=e[0];if(n.finished&&(e.shift(),n=e[0]),!n)return!1;if(n.started||(n.started=!0,n.start()),n.step(t),n.finished){const s=e.indexOf(n);e.splice(s,1)}},D=(i,t)=>{i.timeline.unshift(...t)};class Ze{constructor(t,e,n){this.callback=t,this.timeout=e,this.name=n}start(){}step(t){if(this.timeout>=0&&(this.timeout-=t,this.timeout<0))return this.finished=!0,this.callback()}toString(){return(this.started?"s":"-")+(this.finished?"f":"-")+" "+this.name+" "+this.timeout}}const E=(i,t,e)=>new Ze(i,t,e);performance.now();const ti=60;class ei extends x{constructor(){super(),this.handleActivate=()=>{this.context.hex=new Ft,this.startGame()},this.handleReset=()=>{q(this.context.hex),this.startGame()},this.handleFrameUpdate=t=>{Gt(this.context.hex,t.dt)},this.handleTimeover=()=>{this.endGame()},this.startGame=()=>{Ot(this.context.hex,4),yt(this.context.hex),this.emit("board-set-timer",ti),this.emit("game-start")},this.endGame=()=>{q(this.context.hex),this.emit("game-end")},this.handlePointerDown=t=>{if(this.context.hex.locked)return;const e=xt(this.context.hex,t.x,t.y);if(!e)return;let n=Pt(this.context.hex,e);n.length>1?(this.emit("board-add-score",n.length),n.forEach(s=>{St(this.context.hex,s,!0)}),D(this.context.hex,[E(()=>$e(this.context.hex,1),50,""),E(()=>yt(this.context.hex),150,"")])):n.length==1&&(this.emit("board-add-score",-10),n[0].tile.color=G.x)},this.on("activate",this.handleActivate),this.on("board-time-over",this.handleTimeover),this.on("user-pointer-down",this.handlePointerDown),this.on("user-reset-play",this.handleReset),this.on("frame-update",this.handleFrameUpdate),this.use(new It)}}const ii=60;class ni extends x{constructor(){super(),this.handleFrameUpdate=t=>{Gt(this.context.hex,t.dt)},this.handleReset=()=>{q(this.context.hex),this.startGame()},this.handleTimeover=()=>{this.endGame()},this.startGame=()=>{this.cancelPointer(),Ot(this.context.hex,3),D(this.context.hex,[E(()=>yt(this.context.hex),150)]),this.emit("board-set-timer",ii),this.emit("game-start")},this.handlePointerDown=t=>{this.context.hex.locked||(this.pointDown={x:t.x,y:t.y},this.cellDown=xt(this.context.hex,t.x,t.y),this.dirLock=null)},this.handlePointerMove=t=>{if(this.context.hex.locked||!this.cellDown)return;const e=t.x-this.pointDown.x,n=t.y-this.pointDown.y,s=e*e+n*n;if(this.dirLock==null&&s>=.25&&(this.dirLock=R.fromXY(e,n)),this.dirLock!==null){const r=R.get_xy(this.dirLock),o=r.x*e+r.y*n,h=Math.round(o);h!==0&&(this.pointDown.x=t.x,this.pointDown.y=t.y,Ke(this.context.hex,this.cellDown,this.dirLock,h))}},this.handlePointerUp=t=>{this.context.hex.locked||(this.cellDown=null,this.dirLock=null,this.matchBoard())},this.handlePointerCancel=()=>{this.cancelPointer()},this.cancelPointer=()=>{this.pointDown=null,this.cellDown=null,this.dirLock=null},this.matchBoard=()=>{const t=de(this.context.hex,3);t&&(this.emit("board-add-score",t),D(this.context.hex,[E(()=>yt(this.context.hex),150),E(()=>this.matchBoard(),150)]))},this.on("activate",this.handleActivate),this.on("board-time-over",this.handleTimeover),this.on("user-pointer-down",this.handlePointerDown),this.on("user-pointer-move",this.handlePointerMove),this.on("user-pointer-up",this.handlePointerUp),this.on("user-pointer-cancel",this.handlePointerCancel),this.on("user-reset-play",this.handleReset),this.on("frame-update",this.handleFrameUpdate),this.use(new It)}handleActivate(){this.context.hex=new Ft,this.startGame()}endGame(){this.cancelPointer(),q(this.context.hex),this.emit("game-end")}}class si extends x{constructor(){super(),this.handleFrameUpdate=t=>{Gt(this.context.hex,t.dt)},this.handleReset=()=>{q(this.context.hex),this.emit("disk-remove-game"),this.startGame()},this.startGame=()=>{this.context.hex.inited||(Ot(this.context.hex,4),this.addTiles()),this.emit("game-start")},this.handlePointerDown=t=>{if(this.context.hex.locked)return;const e=xt(this.context.hex,t.x,t.y);e?e.tile&&(this.src?this.src==e||(this.src.tile&&(this.src.tile.selected=!1),this.src=e,this.src.tile&&(this.src.tile.selected=!0)):(this.src=e,this.src.tile&&(this.src.tile.selected=!0))):this.src&&(this.src.tile&&(this.src.tile.selected=!1),this.src=null)},this.handlePointerUp=t=>{if(this.context.hex.locked||!this.src)return;const e=xt(this.context.hex,t.x,t.y);!e||e.tile||(this.src.tile&&(this.src.tile.selected=!1),Wt(this.context.hex,e,this.src,!1),D(this.context.hex,[E(()=>this.matchBoard(!0),200)]),this.src=null)},this.matchBoard=t=>{const e=de(this.context.hex,4);e&&this.emit("board-add-score",e);const n=Ve(this.context.hex);Ht(this.context.hex).length?n.length?t&&!e?D(this.context.hex,[E(()=>this.addTiles(),300)]):this.emit("disk-save-game"):D(this.context.hex,[E(()=>this.addTiles(),e?300:0)]):D(this.context.hex,[E(()=>this.endGame(),500)])},this.addTiles=()=>{let t=this.context.status.currentScore,e;t<60?e=3:t<60*2?e=4:t<60*4?e=5:t<60*7?e=6:t<60*12?e=7:e=8,Je(this.context.hex,e),D(this.context.hex,[E(()=>this.matchBoard(),400)])},this.on("activate",this.handleActivate),this.on("user-pointer-down",this.handlePointerDown),this.on("user-pointer-up",this.handlePointerUp),this.on("user-reset-play",this.handleReset),this.on("frame-update",this.handleFrameUpdate),this.use(new It)}handleActivate(){this.context.hex=new Ft,this.emit("disk-load-game"),D(this.context.hex,[E(()=>this.startGame(),50)])}endGame(){q(this.context.hex),this.emit("disk-remove-game"),this.emit("game-end")}}class ri{static time(t){const e=Math.floor(t/1e3),n=e%60;return(e/60|0)+":"+("0"+n).slice(-2)}}const T=29;class Ut extends x{constructor(){super(),this.handleActivate=()=>{this.createComponents(),this.container.appendTo(this.context.layout)},this.handleDeactivate=()=>{this.container.remove()},this.gameStateMemo=N.init(),this.handleFrameRender=()=>{var n;const t=this.context.status;if(this.gameStateMemo.update(t.state)){if(t.state==="playing")this.resetButton.stop(0),this.lastScore.hide();else if(t.state==="gameover"){this.resetButton.play(),this.lastScore.show();const s=t.currentScore>0&&(!t.topScore||t.currentScore>t.topScore);this.lastScore.value(t.currentScore+(s?"S":""))}t!=null&&t.topScore?(this.topScore.value(t.topScore+"s"),this.topScore.show()):this.topScore.hide()}if(this.scoreTotal.value(t.currentScore),t.newScore){const s=(t.newScore>0?"+":"")+t.newScore;this.scoreAdded.value(s),this.scoreAdded.show()}else this.scoreAdded.hide();typeof t.timer=="number"&&t.timer>=0?(this.timer.value(ri.time(t.timer)),this.timer.show()):this.timer.hide();const e=this.context.hex;(n=e.nextTiles)!=null&&n.length?(this.nextTiles.value(e.nextTiles.join("")),this.nextTiles.show()):this.nextTiles.hide(),this.hexBoard.show(),t.state==="playing"?this.binder.data([...e.tiles,...e.cells]):this.binder.data([])},this.renderCell=_t.create({filter:t=>t.type=="cell",enter:t=>{const e=new oi;return e.appendTo(this.hexCells),e.enter(t),e},update:(t,e)=>{e.update(t)},exit:(t,e)=>{e.exit(t)}}),this.renderTile=_t.create({filter:t=>t.type=="tile",enter:t=>{const e=new hi;return e.appendTo(this.hexTiles),e.enter(t),e},update:(t,e)=>{e.update(t)},exit:(t,e)=>{e.exit(t)}}),this.binder=Lt.create({key:t=>t.key,drivers:[this.renderCell,this.renderTile]}),this.on("activate",this.handleActivate),this.on("deactivate",this.handleDeactivate),this.on("frame-render",this.handleFrameRender)}createComponents(){return this.container?!1:(this.container=ce(),this.resetButton=He("reset",1),this.resetButton.appendTo(this.container),this.resetButton.pin({alignX:1,alignY:1,offsetX:-5,offsetY:-5}),this.resetButton.on(dt,()=>this.emit("user-reset-play")),this.homeButton=gt("burger"),this.homeButton.appendTo(this.container),this.homeButton.pin({alignX:0,alignY:1,offsetX:5,offsetY:-5}),this.homeButton.on(dt,()=>this.emit("set-screen",{name:"home"})),this.nextTiles=z("tile"),this.nextTiles.appendTo(this.container),this.nextTiles.pin({alignX:1,alignY:0,offsetX:-9,offsetY:10,scale:.4}),this.scoreTotal=z("digit"),this.scoreTotal.appendTo(this.container),this.scoreTotal.pin({alignX:0,alignY:0,offsetX:9,offsetY:8,scale:1.1}),this.scoreAdded=z("digit"),this.scoreAdded.appendTo(this.container),this.scoreAdded.pin({alignX:.5,alignY:0,offsetX:0,offsetY:8,scale:.9}),this.timer=z("digit"),this.timer.appendTo(this.container),this.timer.pin({alignX:1,alignY:0,handleX:0,offsetX:-50,offsetY:8,scale:1.1}),this.lastScore=z("digit"),this.lastScore.appendTo(this.container),this.lastScore.pin({align:.5,scale:1.4}),this.topScore=z("digit"),this.topScore.appendTo(this.container),this.topScore.pin({alignX:.5,alignY:1,offsetX:0,offsetY:-14,scale:.8}),this.hexBoard=ft(),this.hexBoard.attr("spy",!0),this.hexBoard.prependTo(this.container),this.hexBoard.pin({align:.5,handle:0}),this.hexCells=ft(),this.hexCells.appendTo(this.hexBoard),this.hexTiles=ft(),this.hexTiles.appendTo(this.hexBoard),this.hexBoard.on(Be,t=>(this.emit("user-pointer-down",{x:t.x/T,y:t.y/T}),!0)),this.hexBoard.on(Pe,t=>(this.emit("user-pointer-move",{x:t.x/T,y:t.y/T}),!0)),this.hexBoard.on(Re,t=>(this.emit("user-pointer-up",{x:t.x/T,y:t.y/T}),!0)),this.hexBoard.on(je,t=>(this.emit("user-pointer-cancel"),!0)),this.hexBoard.on(dt,t=>(this.emit("click",{x:t.x/T,y:t.y/T}),!0)),!0)}}class oi extends ue{constructor(){super(),this.texture("cell")}enter(t){}update(t){const e=(t.x-.5)*T,n=(t.y-.5)*T;this.offset(e,n),this.visible(!t.hidden)}exit(t){this.remove()}}class hi extends le{constructor(){super(),this.transformMemo=N.init(),this.colorMemo=N.init(),this.selectedMemo=N.init(),this.frames("tile"),this.value("x")}enter(t){this.value(t.color),this.pin("pivot",.5),this.scale(.01).alpha(.01).tween(100).scale(1).alpha(1)}update(t){if(this.transformMemo.update(t.cell.x,t.cell.y)){const e=(t.cell.x-.5)*T,n=(t.cell.y-.5)*T;t.slide?this.tween(100).scale(1).offset(e,n):t.jump?this.tween(100).scale(0).tween(100).scale(1).offset(e,n):this.scale(1).offset(e,n)}this.colorMemo.update(t.color)&&this.value(t.color),this.selectedMemo.update(t.selected)&&this.scale(t.selected?1.15:1).alpha(.9)}exit(t){t.collected?this.tween(100).alpha(.01).scale(.01).remove():this.remove()}}class ai extends x{constructor(){super(),this.stageScreen=()=>{this.container||(this.container=ce(),this.menu=Ye(.5),this.menu.appendTo(this.container),this.menu.pin("align",.5),this.logo=gt("logo"),this.logo.appendTo(this.menu),this.modes=[1,2,3].map(t=>{const e=gt("mode_"+t);return e.appendTo(this.menu),e.pin("pivot",.5),e.on(dt,()=>this.handleClickMode(t)),e}))},this.handleDeactivate=()=>{this.container.remove()},this.handleClickMode=t=>{this.emit("set-screen",{name:"play-"+t,mode:t})},this.animateOpen=()=>{this.modes.forEach(function(t,e){t.scale(1).tween(120*e+150).tween(300).ease("linear-in-out").scale(1.2).tween(300).ease("linear-in-out").scale(1)})},this.on("activate",this.handleActivate),this.on("deactivate",this.handleDeactivate)}handleActivate(){this.stageScreen(),this.container.appendTo(this.context.layout),this.animateOpen()}}const ci="/polymatic-example-six/assets/background-FZ3cb74c.png",ui="/polymatic-example-six/assets/tiles-fjLyTWMU.png",li="/polymatic-example-six/assets/menu-0QwkpUIL.png",fi="/polymatic-example-six/assets/text-D93SdtPq.png",di="/polymatic-example-six/assets/logo-Eg8uiIyy.png";class pi extends x{constructor(){super(),this.handleActivate=async()=>{await K({image:{src:ci},textures:{background:{x:0,y:0,width:512,height:512}}}),await K({image:{src:di,ratio:4},textures:{logo:{x:0,y:0,width:128,height:64}}}),await K({image:{src:ui,ratio:4},textures:{cell:{x:30*6,y:0,width:30,height:30},tile_r:{x:30*0,y:0,width:30,height:30},tile_g:{x:30*1,y:0,width:30,height:30},tile_b:{x:30*2,y:0,width:30,height:30},tile_y:{x:30*3,y:0,width:30,height:30},tile_p:{x:30*4,y:0,width:30,height:30},tile_x:{x:30*5,y:0,width:30,height:30},tile:{r:"tile_r",g:"tile_g",b:"tile_b",y:"tile_y",p:"tile_p",x:"tile_x"}}}),await K({image:{src:li,ratio:4},textures:{mode_1:{x:0,y:0,width:128,height:64},mode_2:{x:0,y:64,width:128,height:64},mode_3:{x:0,y:128,width:128,height:64}}}),await K({image:{src:fi,ratio:4},textures:{burger:{x:30*0,y:30,width:30,height:30},reset:[{x:30*1,y:30,width:30,height:30},{x:30*2,y:30,width:30,height:30}],digit:{0:{x:20*0,y:3,width:11,height:15},1:{x:20*1,y:3,width:11,height:15},2:{x:20*2,y:3,width:13,height:15},3:{x:20*3,y:3,width:11.5,height:15},4:{x:20*4,y:3,width:12.5,height:15},5:{x:20*5,y:3,width:12,height:15},6:{x:20*6,y:3,width:12,height:15},7:{x:20*7,y:3,width:15,height:15},8:{x:20*8,y:3,width:11,height:15},9:{x:20*9,y:3,width:10,height:15},"-":{x:20*10,y:3,width:11,height:15},"+":{x:20*11,y:3,width:10,height:15},":":{x:20*12,y:3,width:6,height:15},s:{x:200,y:33,width:18,height:15},S:{x:220,y:33,width:18,height:15}}}}),this.context.stage=Fe(),this.emit("stage-loaded")},this.on("activate",this.handleActivate)}}class _i extends x{constructor(){super(),this.handleViewport=()=>{const t=this.context.stage.viewport();this.background.fit(t.width,t.height,"out");const e=Math.min(650*t.ratio,t.height),n=Math.min(600*t.ratio,t.width,e);this.context.layout.fit(n,e,"contain")},this.on("stage-loaded",this.handleStageLoaded)}handleStageLoaded(){this.background=gt("background"),this.background.appendTo(this.context.stage),this.background.pin("align",.5),this.background.pin("handle",.5),this.context.layout=ft(),this.context.layout.appendTo(this.context.stage),this.context.layout.pin("align",.5),this.context.layout.size(200,300),this.context.stage.on("viewport",this.handleViewport),this.handleViewport(),this.emit("set-screen",{name:"home"})}}class vi extends x{constructor(t){super(),this.handleSetScreen=e=>{const n=e.name,s=this.screens[n];if(!s){console.error("Unknown screen",n);return}this.setContext(r=>{r.screen=e}),this._swap([s])},this.screens=t,this.on("set-screen",this.handleSetScreen)}}const ee="six-top-score-v2-",kt="six-save-game-v2-";class mi extends x{constructor(){super(),this.handleGameStart=()=>{const t=this.context.screen.mode,e=this.context.status,n=this.loadHighScore(t);n>0&&(e.topScore=n)},this.handleGameEnd=()=>{const t=this.context.screen.mode,e=this.context.status;e.currentScore>0&&e.currentScore>e.topScore&&this.saveHighScore(t,e.currentScore)},this.saveHighScore=(t,e)=>{const n=ee+t;try{localStorage.setItem(n,String(e))}catch(s){console.log(s)}},this.loadHighScore=t=>{const e=ee+t;try{const n=+localStorage.getItem(e);if(n>0)return n}catch(n){console.error(n)}return 0},this.saveGame=()=>{const t=this.context.screen.mode,e=kt+t;try{const n={score:this.context.status.currentScore,queue:this.context.hex.nextTiles??void 0,cells:this.context.hex.cells.map(r=>{var o;return{i:r.i,j:r.j,color:((o=r.tile)==null?void 0:o.color)??void 0}})};console.debug(n);const s=JSON.stringify(n);localStorage.setItem(e,s)}catch(n){console.log(n)}},this.loadGame=()=>{const t=this.context.screen.mode,e=kt+t;try{const n=localStorage.getItem(e);if(!n)return!1;const s=JSON.parse(n);return this.context.status.currentScore=s.score,s.cells.forEach(r=>{const o=P(this.context.hex,r.i,r.j,!0);if(r.color){const h=new Dt(r.color);bt(this.context.hex,o,h)}}),s.queue&&(this.context.hex.nextTiles=s.queue),this.context.hex.inited=!0,!0}catch(n){console.log(n)}return!1},this.dropGame=()=>{const t=this.context.screen.mode,e=kt+t;localStorage.removeItem(e)},this.on("game-start",this.handleGameStart),this.on("game-end",this.handleGameEnd),this.on("disk-save-game",this.saveGame),this.on("disk-load-game",this.loadGame),this.on("disk-remove-game",this.dropGame)}}class gi extends x{constructor(){super(),this.on("stage-loaded",this.handleLoaded),this.use(new Ge),this.use(new pi),this.use(new _i),this.use(new mi),this.use(new vi({"play-1":new xi,"play-2":new yi,"play-3":new wi,home:new ai}))}handleLoaded(){this.emit("set-screen",{name:"home"})}}class xi extends x{constructor(){super(),this.use(new ei),this.use(new Ut)}}class yi extends x{constructor(){super(),this.use(new ni),this.use(new Ut)}}class wi extends x{constructor(){super(),this.use(new si),this.use(new Ut)}}x.activate(new gi,{});
